ä»¥ä¸‹ã€**æœ€æ–°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã« LocalAIï¼ˆç„¡æ–™ãƒ¢ãƒ‡ãƒ«ï¼‰ã® LLMã‚³ãƒ³ãƒ†ãƒŠ ã‚’è¿½åŠ ã—ãŸ POC æ§‹æˆ**ã§ã™ã€‚

---

## ğŸ§© `docker-compose.yml`

```yaml
version: "3.9"
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    env_file:
      - .env
    depends_on:
      - db
      - llm

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    env_file:
      - .env
    depends_on:
      - backend

  db:
    image: postgres:15
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: changethis
      POSTGRES_DB: mydb
    volumes:
      - pgdata:/var/lib/postgresql/data

  llm:
    image: localai/localai:latest-aio-cpu
    ports:
      - "8080:8080"
    volumes:
      - ./models:/models
    command: ["--models-path", "/models"]
    # å…¨ã¦ç„¡æ–™ãƒ»CPUå¯¾å¿œå¯èƒ½ãªAIOã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ :contentReference[oaicite:1]{index=1}

volumes:
  pgdata:
```

---

## ğŸ›  `backend/Dockerfile`

```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY ./app ./app
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

* FastAPI ã‚’ç‹¬è‡ªæ§‹ç¯‰ã€‚è»½é‡ã‹ã¤æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&#x20;

---

## ğŸ§© ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆtreeï¼‰

```text
my-poc/
â”œâ”€â”€ docker-compose.yml           # ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆï¼ˆbackend/frontend/db/llmï¼‰
â”œâ”€â”€ .env                         # DB_URL, LLM_URL, ç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ models/                      # LocalAIç”¨ãƒ¢ãƒ‡ãƒ«ç½®ãå ´
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile              # FastAPIç”¨
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ main.py             # FastAPIã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åˆæœŸåŒ–
â”‚       â”œâ”€â”€ api/
â”‚       â”‚   â”œâ”€â”€ generative.py   # å•é¡Œç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (`/generate-question`) - LLMå‘¼ã³å‡ºã—å«ã‚€
â”‚       â”‚   â””â”€â”€ grader.py       # å›ç­”æ¡ç‚¹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (`/submit-sql`) - DBå®Ÿè¡Œï¼‹çµæœæ¯”è¼ƒï¼‹è§£èª¬
â”‚       â”œâ”€â”€ core/
â”‚       â”‚   â”œâ”€â”€ db.py           # PostgreSQLæ¥ç¶šç®¡ç†ï¼ˆasyncpg or SQLModelï¼‰
â”‚       â”‚   â””â”€â”€ models.py       # æ­£è§£SQLç­‰ä¿å­˜ç”¨ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â”‚       â””â”€â”€ schemas.py          # Pydantic å…¥å‡ºåŠ›ãƒ¢ãƒ‡ãƒ«å®šç¾©
â””â”€â”€ frontend/
    â”œâ”€â”€ Dockerfile              # Next.js or React é–‹ç™ºç’°å¢ƒ
    â”œâ”€â”€ package.json
    â””â”€â”€ src/ or pages/
        â”œâ”€â”€ index.tsx          # å•é¡Œå–å¾— â†’ ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º + SQLå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
        â””â”€â”€ result.tsx         # çµæœå—ä¿¡ â†’ æ­£èª¤åˆ¤å®š + è§£èª¬è¡¨ç¤º
```

---

## ğŸ“Œ å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›®çš„ã¨æ©Ÿèƒ½

* **docker-compose.yml**

  * 4ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆbackend/frontend/db/llmï¼‰ã‚’å®šç¾©ã—ç›¸äº’æ¥ç¶š
  * LocalAI ã«ã‚ˆã‚‹ LLM å±¤ã‚’å®Ÿè£…ã—ã€OpenAI å½¢å¼ API æä¾›

* **backend/Dockerfile**

  * Python 3.11 ã‚’åˆ©ç”¨ã—ã€FastAPI ã‚’è»½é‡ã«å®Ÿè£…
  * `uvicorn` ã§ã‚µãƒ¼ãƒèµ·å‹•æ§‹æˆ

* **app/main.py**

  * FastAPI èµ·å‹•ã€CORS è¨­å®šã€ãƒ«ãƒ¼ã‚¿ãƒ¼çµ±åˆ

* **app/api/generative.py**

  * `/generate-question`ï¼šDB ã‚¹ã‚­ãƒ¼ãƒã¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã€LLM ã«æŠ•ã’ã¦è‡ªç„¶è¨€èªå•é¡Œï¼‹æ­£è§£SQLã‚’ç”Ÿæˆ

* **app/api/grader.py**

  * `/submit-sql`ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼SQLã‚’ DB å®Ÿè¡Œã—ã€æ­£è§£SQL çµæœã¨æ¯”è¼ƒã€‚é•ã„ãŒã‚ã‚Œã°å†åº¦ LLM ã«å·®åˆ†è§£èª¬ã‚’ç”Ÿæˆ

* **app/core/db.py**

  * asyncpg ã¾ãŸã¯ SQLModel ã§éåŒæœŸ DB æ¥ç¶š + åˆå›ã‚¹ã‚­ãƒ¼ãƒï¼ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

* **app/core/models.py**

  * SQLModelãªã©ã§å•é¡Œï¼æ­£è§£ä¿å­˜ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

* **app/schemas.py**

  * Pydantic å…¥åŠ›ãƒ»å‡ºåŠ›ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆClean å±¤ï¼‰

* **frontend/index.tsx**

  * å•é¡Œå–å¾—ãƒœã‚¿ãƒ³ã€å•é¡Œæ–‡è¡¨ç¤ºã€SQL ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›æ¬„ã€é€ä¿¡ãƒœã‚¿ãƒ³ UI

* **frontend/result.tsx**

  * FastAPI `/submit-sql` çµæœã‚’å—ã‘å–ã‚Šã€ãƒ†ãƒ¼ãƒ–ãƒ«çµæœãƒ»æ­£èª¤å¯è¦–åŒ–ãƒ»è§£èª¬è¡¨ç¤º

---

## âœ… è¦ä»¶å®šç¾©ã¾ã¨ã‚

| å±¤          | ãƒ•ã‚¡ã‚¤ãƒ«/æ©Ÿèƒ½                   | è¦ä»¶                                             |
| ---------- | ------------------------- | ---------------------------------------------- |
| **ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆ** | docker-compose.yml        | FastAPI/API/API+LLMçµ±åˆ/db/LocalAI ç„¡æ–™ãƒ¢ãƒ‡ãƒ«èµ·å‹•ï¼ˆCPUå¯ï¼‰ |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** | generative.py / grader.py | LLMæŠ•ã’â†’SQLç”Ÿæˆï¼æ¤œè¨¼â†’æ¡ç‚¹ï¼‹è§£èª¬ç”Ÿæˆ                         |
| **DB å±¤**   | db.py / models.py         | PostgreSQLæ“ä½œï¼SQLå®Ÿè¡Œï¼ã‚¹ã‚­ãƒ¼ãƒç®¡ç†                      |
| **ãƒ•ãƒ­ãƒ³ãƒˆ**   | index.tsx / result.tsx    | UIæç”»ï¼ˆå•é¡Œ â†’ å…¥åŠ› â†’ è¡¨ç¤ºï¼‰                             |

POCã¨ã—ã¦ã®**æœ€å°é™ã‹ã¤å®Œå…¨ãªé–‹ç™ºãƒ•ãƒ­ãƒ¼**ã«å¯¾å¿œã™ã‚‹æ§‹æˆã§ã™ã€‚
ã“ã®è¨­è¨ˆã§é€²ã‚ã¦ã‚ˆã‚ã—ã‘ã‚Œã°ã€å³ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»å‹•ä½œç¢ºèªã®æ¬¡ã‚¹ãƒ†ãƒƒãƒ—ã¸ç§»è¡Œã§ãã¾ã™ğŸ˜Š
